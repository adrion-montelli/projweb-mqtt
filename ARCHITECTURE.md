# ๐๏ธ Arquitetura do Projeto

## Visรฃo Geral

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    CLIENTE (Browser)                    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ Bootstrap 5 + Tailwind CSS + Material Icons     โ   โ
โ  โ Chart.js | jQuery | AJAX/Fetch API              โ   โ
โ  โ Dark Mode Theme (localStorage)                   โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โผ                                    โฒ
         HTTP/HTTPS                         JSON/HTML
              โผ                                    โฒ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ           CAMADA DE APLICAรรO (Django)                  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ Views & URLs                                      โ   โ
โ  โ  โข dashboard_view()   - Dashboard principal      โ   โ
โ  โ  โข chart_data_view()  - API de grรกficos         โ   โ
โ  โ  โข chart_summary()    - API de estatรญsticas     โ   โ
โ  โ                                                  โ   โ
โ  โ Middleware (Seguranรงa)                           โ   โ
โ  โ  โข CSRF Protection                               โ   โ
โ  โ  โข Authentication                                โ   โ
โ  โ  โข CORS Headers                                  โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โผ                                    โฒ
          ORM/SQL                             ResultSet
              โผ                                    โฒ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ          CAMADA DE PERSISTรNCIA (Banco)                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ Banco de Dados                                    โ   โ
โ  โ  โข MySQL (Produรงรฃo)          - InnoDB Tables   โ   โ
โ  โ  โข SQLite (Desenvolvimento)  - Arquivo Local   โ   โ
โ  โ                                                  โ   โ
โ  โ Modelos Django                                   โ   โ
โ  โ  โข CorrenteBrunidores                            โ   โ
โ  โ  โข CorrenteDescascadores                         โ   โ
โ  โ  โข CorrentePolidores                             โ   โ
โ  โ  โข Temperatura                                   โ   โ
โ  โ  โข DadosAgregados                                โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## Estrutura de Diretรณrios

```
ProjetoFinalRev4/
โ
โโโ ๐ Documentaรงรฃo
โ   โโโ README.md                 # Guia principal
โ   โโโ DEPLOYMENT.md             # Deploy em produรงรฃo
โ   โโโ CONTRIBUTING.md           # Como contribuir
โ   โโโ CHANGELOG.md              # Histรณrico de versรตes
โ   โโโ REFACTORING_SUMMARY.md    # Resumo das mudanรงas
โ   โโโ QUICKSTART.md             # Inicializaรงรฃo rรกpida
โ   โโโ LICENSE                   # Licenรงa MIT
โ
โโโ ๐ณ Docker
โ   โโโ Dockerfile                # Imagem Docker
โ   โโโ docker-compose.yml        # Orquestraรงรฃo
โ
โโโ ๐ง Scripts
โ   โโโ setup.sh                  # Setup Linux/macOS
โ   โโโ setup.bat                 # Setup Windows
โ   โโโ manage.py                 # CLI Django
โ
โโโ โ๏ธ Configuraรงรฃo
โ   โโโ .env.example              # Variรกveis de ambiente
โ   โโโ .gitignore                # Git ignore patterns
โ   โโโ requirements.txt          # Dependรชncias Python
โ   โโโ package.json              # Metadados
โ
โโโ ๐ leituras_project/          # Configuraรงรฃo Django
โ   โโโ __init__.py
โ   โโโ settings.py               # โ๏ธ Configuraรงรตes principales
โ   โโโ urls.py                   # ๐ Rotas HTTP
โ   โโโ wsgi.py                   # Produรงรฃo (Gunicorn)
โ   โโโ asgi.py                   # WebSockets (futuro)
โ   โโโ __pycache__/
โ
โโโ ๐ leituras/                  # App Django Principal
โ   โโโ __init__.py
โ   โโโ models.py                 # ๐๏ธ Modelos de dados
โ   โโโ views.py                  # ๐๏ธ Lรณgica de negรณcio
โ   โโโ urls.py                   # ๐ Rotas da app
โ   โโโ admin.py                  # ๐จ Admin panel
โ   โโโ apps.py
โ   โโโ forms.py                  # ๐ Formulรกrios
โ   โโโ tests.py                  # โ Testes unitรกrios
โ   โ
โ   โโโ ๐ migrations/            # ๐ Histรณrico BD
โ   โ   โโโ 0001_initial.py
โ   โ   โโโ __pycache__/
โ   โ
โ   โโโ ๐ management/
โ   โ   โโโ ๐ commands/
โ   โ       โโโ agregar_leituras.py
โ   โ       โโโ contar_registros.py
โ   โ       โโโ testar_conexao.py
โ   โ
โ   โโโ ๐ __pycache__/
โ
โโโ ๐ templates/                 # Templates HTML Django
โ   โโโ base.html                 # ๐ฒ Layout base
โ   โโโ login.html                # ๐ Pรกgina de login
โ   โโโ dashboard.html            # ๐ Dashboard principal
โ   โ
โ   โโโ ๐ leituras/
โ       โโโ index.html            # ๐ Listagem
โ
โโโ ๐ static/                    # Assets estรกticos
โ   โโโ ๐ images/
โ   โ   โโโ favicon.ico           # ๐ Favicon
โ   โ   โโโ logo.png              # ๐ธ Logo
โ   โ
โ   โโโ ๐ src/
โ       โโโ ๐ css/
โ       โ   โโโ style.css         # ๐จ Estilos principais
โ       โ   โโโ app.css           # ๐จ Estilos da app
โ       โ   โโโ responsive.css    # ๐ฑ Responsividade
โ       โ
โ       โโโ ๐ js/
โ           โโโ dashboard.js      # ๐ฎ Scripts dashboard
โ           โโโ app.js            # ๐ฎ Scripts gerais
โ           โโโ utils.js          # ๐ง Utilitรกrios
โ
โโโ ๐ staticfiles/               # Assets compilados (produรงรฃo)
โ
โโโ ๐ media/                     # Uploads de usuรกrios
โ
โโโ ๐ database/                  # Arquivos de banco local
โ   โโโ db.sqlite3                # SQLite (dev)
โ
โโโ ๐ __pycache__/               # Cache Python
```

---

## Fluxo de Dados

### 1. Autenticaรงรฃo (Login)

```
Usuรกrio                Browser              Django                    DB
   โ                      โ                   โ                        โ
   โ Acessa /login        โ                   โ                        โ
   โโโโโโโโโโโโโโโโโโโโโโ>โ                   โ                        โ
   โ                      โ GET /login        โ                        โ
   โ                      โโโโโโโโโโโโโโโโโโ>โ Retorna form HTML      โ
   โ Preenche form        โ<โโโโโโโโโโโโโโโโโโโค                        โ
   โ e submete            โ                   โ                        โ
   โ                      โ POST /login       โ                        โ
   โ                      โโโโโโโโโโโโโโโโโโ>โ Valida credenciais     โ
   โ                      โ                   โโโโโโโโโโโโโโโโโโโโโโโ>โ
   โ                      โ                   โ SELECT * FROM auth_userโ
   โ                      โ<โโโโโโโโโโโโโโโโโโโค<โโโโโโโโโโโโโโโโโโโโโโโค
   โ Login OK             โ Redirect /dash    โ                        โ
   โ<โโโโโโโโโโโโโโโโโโโโโโค<โโโโโโโโโโโโโโโโโโค                        โ
   โ (Session Cookie)     โ                   โ                        โ
```

### 2. Dashboard (Carregamento)

```
Usuรกrio                Browser              Django                    DB
   โ                      โ                   โ                        โ
   โ Acessa /dashboard    โ                   โ                        โ
   โโโโโโโโโโโโโโโโโโโโโโ>โ                   โ                        โ
   โ                      โ GET /dashboard    โ                        โ
   โ                      โโโโโโโโโโโโโโโโโโ>โ @login_required        โ
   โ                      โ                   โ Valida sessรฃo          โ
   โ                      โ                   โ Busca dados            โ
   โ                      โ                   โโโโโโโโโโโโโโโโโโโโโโโ>โ
   โ                      โ                   โ SELECT * FROM leiturasโ
   โ                      โ                   โ AGGREGATE functions   โ
   โ                      โ<โโโโโโโโโโโโโโโโโโโค<โโโโโโโโโโโโโโโโโโโโโโโค
   โ                      โ HTML com dados    โ                        โ
   โ Dashboard renderizadoโ<โโโโโโโโโโโโโโโโโโค                        โ
   โ                      โ                   โ                        โ
   โ Clica em grรกfico     โ AJAX GET /api/..  โ                        โ
   โ (filtro)             โโโโโโโโโโโโโโโโโโ>โ Processa filtros      โ
   โ                      โ                   โโโโโโโโโโโโโโโโโโโโโโโ>โ
   โ Grรกfico atualiza     โ JSON {labels, dataโ<โโโโโโโโโโโโโโโโโโโโโโโค
   โ<โโโโโโโโโโโโโโโโโโโโโโค<โโโโโโโโโโโโโโโโโโค                        โ
   โ (sem recarregar)     โ                   โ                        โ
```

### 3. API de Grรกficos (AJAX)

```
JavaScript              Fetch/AJAX           Django URL              View              Database
    โ                        โ                   โ                     โ                  โ
    โ fetch('/api/chart')    โ                   โ                     โ                  โ
    โโโโโโโโโโโโโโโโโโโโโโโ>โ                   โ                     โ                  โ
    โ                        โ GET /api/chart    โ                     โ                  โ
    โ                        โโโโโโโโโโโโโโโโโโโ>โ chart_data_view()   โ                  โ
    โ                        โ                   โโโโโโโโโโโโโโโโโโโโโ>โ                  โ
    โ                        โ                   โ                     โ ORM Query       โ
    โ                        โ                   โ                     โโโโโโโโโโโโโโโโโโ>โ
    โ                        โ                   โ                     โ<โโโโโโโโโโโโโโโโโโค
    โ                        โ JSON Response     โ                     โ Dict com dados   โ
    โ                        โ<โโโโโโโโโโโโโโโโโโโค<โโโโโโโโโโโโโโโโโโโโโโค                  โ
    โ .json()                โ                   โ                     โ                  โ
    โ<โโโโโโโโโโโโโโโโโโโโโโโโ                   โ                     โ                  โ
    โ Chart.update()         โ                   โ                     โ                  โ
    โ (re-render)            โ                   โ                     โ                  โ
```

---

## Stack Tecnolรณgico

### Backend
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Django 4.2.7 Framework                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ โข Django ORM (Database Abstraction)    โ
โ โข Django Auth (User Management)         โ
โ โข Django Forms (Validation)              โ
โ โข Django Signals (Event Handlers)       โ
โ โข Django Middleware (CSRF, Auth)        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Gunicorn 22.0.0 (WSGI Server)          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ โข Worker Sync (4 workers)               โ
โ โข Unix Socket Communication             โ
โ โข Graceful Shutdown                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### Banco de Dados
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Desenvolvimento: SQLite                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ โข Arquivo db.sqlite3                    โ
โ โข Zero configuraรงรฃo                     โ
โ โข Rรกpido para testes                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Produรงรฃo: MySQL 8.0                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ โข InnoDB Storage Engine                 โ
โ โข UTF-8mb4 Charset                      โ
โ โข Connection pooling                    โ
โ โข Replicaรงรฃo suportada                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### Frontend
```
Bootstrap 5.3.3         โ Tailwind CSS        โ Material Icons
โโโโโโโโโโโโโโโโโโโโโโโค โโโโโโโโโโโโโโโโโโโโค โโโโโโโโโโโโโโโโโโโโ
โ CSS Framework       โ โ Utility-First    โ โ 1000+ รcones    โ
โ Componentes Prontos โ โ Customizรกvel     โ โ Classe Material  โ
โ Temas Prontos       โ โ Responsivo       โ โ Alinhados       โ
โ Dark Mode Built-in  โ โ Acessibilidade   โ โ                  โ
โโโโโโโโโโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโโโโโโ

Chart.js 4.4.0          โ AJAX/Fetch API      โ ES6 JavaScript
โโโโโโโโโโโโโโโโโโโโโโโค โโโโโโโโโโโโโโโโโโโโค โโโโโโโโโโโโโโโโโโโโ
โ Grรกficos Interativosโ โ Requisiรงรตes HTTP โ โ Classes          โ
โ 8+ Tipos           โ โ Async/Await      โ โ Arrow Functions  โ
โ Responsivo         โ โ JSON Processing  โ โ Template Literalsโ
โ Customizรกvel       โ โ CORS Support     โ โ Spread Operator  โ
โโโโโโโโโโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโโโโโโ
```

---

## Padrรตes de Design Utilizados

### 1. **MVC (Model-View-Controller)**
```
Models (leituras/models.py) โ Camada de dados
Views (leituras/views.py)   โ Lรณgica de negรณcio
Templates (templates/)       โ Apresentaรงรฃo
```

### 2. **Repository Pattern (Django ORM)**
```python
# Ao invรฉs de SQL puro:
# SELECT * FROM temperatura WHERE id_cliente='X'

# Usamos ORM:
Temperatura.objects.filter(id_cliente='X')
```

### 3. **Decorator Pattern (Django)**
```python
@login_required
@require_http_methods(['GET'])
@cache_page(60)
def minha_view(request):
    pass
```

### 4. **Observer Pattern (Signals)**
```python
# Executar cรณdigo quando um modelo รฉ salvo
@receiver(post_save, sender=Temperatura)
def processar_temperatura(sender, instance, **kwargs):
    pass
```

### 5. **Factory Pattern (Modelos)**
```python
temperatura = Temperatura.objects.create(
    id_cliente='X',
    temperatura=25.5
)
```

---

## Fluxo de Desenvolvimento

```
1. Feature Planejamento
   โ
   โโ> Criar Branch (feature/x)
   โ
   โโ> Desenvolvimento
   โ   โโ> Modelo (models.py)
   โ   โโ> Lรณgica (views.py)
   โ   โโ> Template (templates/)
   โ   โโ> Estilo (static/css/)
   โ   โโ> Script (static/js/)
   โ
   โโ> Testes (test_*.py)
   โ
   โโ> Commit & Push
   โ
   โโ> Pull Request โ Code Review โ Merge
```

---

## Performance

### Otimizaรงรตes Implementadas

โ **Database:**
- รndices nas colunas mais consultadas
- Select_related / Prefetch_related
- Aggregate queries para estatรญsticas
- Query limiting (LIMIT 50)

โ **Frontend:**
- CSS minificado
- JavaScript bundled
- Lazy loading de imagens
- Caching com localStorage

โ **Server:**
- Gunicorn workers (4)
- Static file serving via Nginx
- Gzip compression
- Browser caching headers

---

## Escalabilidade

### Horizontal
```
Load Balancer
    โ
    โโ> Django Server 1
    โโ> Django Server 2
    โโ> Django Server 3
    
Database (MySQL Replication)
    โโ> Primary
    โโ> Replica 1
    โโ> Replica 2
```

### Vertical
```
โข Aumentar workers Gunicorn
โข Aumentar RAM do servidor
โข Otimizar queries de banco
โข Implementar caching (Redis)
```

---

## Seguranรงa em Camadas

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 1. HTTPS/TLS                            โ
โ    Criptografia em trรขnsito             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 2. Firewall / WAF                       โ
โ    Bloqueio de requisiรงรตes suspeitas   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 3. Autenticaรงรฃo                         โ
โ    Django User Model + Hash PBKDF2     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 4. Autorizaรงรฃo                          โ
โ    Decoradores @login_required          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 5. Input Validation                     โ
โ    Django ORM escapa SQL Injection      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 6. CSRF Protection                      โ
โ    Django CSRF middleware               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 7. XSS Prevention                       โ
โ    Template escaping automรกtico         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

**รltima Atualizaรงรฃo:** Novembro 2024
